<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Maze Game</title>

  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;


      background-image: url("background.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      font-family: Arial, sans-serif;
    }

    .game-container {
      text-align: center;
      background: none;
      padding: 0;
    }

    h1 {
      margin-bottom: 6px;
    }

    #info {
      margin-bottom: 8px;
      font-size: 16px;
    }

    #timer {
      font-weight: bold;
    }

    canvas {
      border: 2px solid #333;
      display: block;
      margin: 0 auto;
    }

    #message {
      margin-top: 8px;
      font-size: 18px;
      min-height: 24px;
    }

    #restart {
      margin-top: 10px;
      padding: 10px 18px;
      cursor: pointer;
      border-radius: 18px;
      border: none;
      background-color: #f27e8b;
      color: white;
      font-size: 16px;
      font-weight: bold;
    }

    #restart:hover {
      background-color: #e56775;
    }
  </style>
</head>

<body>
  <div class="game-container">
    <h1>Maze Game</h1>

    <div id="info">
      Time left: <span id="timer">45</span>s |
      Use arrow keys to move Hello Kitty to the strawberry
    </div>

    <canvas id="mazeCanvas" width="620" height="420"></canvas>

    <div id="message"></div>

    <button id="restart">Restart</button>
  </div>

  <script>
    const ROWS = 21;
    const COLS = 31;
    const CELL_SIZE = 20;
    const TOTAL_TIME = 45;
    const SPRITE_SCALE = 1.8;

    const canvas = document.getElementById("mazeCanvas");
    const ctx = canvas.getContext("2d");
    const timerSpan = document.getElementById("timer");
    const messageDiv = document.getElementById("message");
    const restartBtn = document.getElementById("restart");

    let maze = [];
    let player = { r: 1, c: 1 };
    let goal = { r: ROWS - 2, c: COLS - 2 };
    let timeLeft = TOTAL_TIME;
    let gameOver = false;
    let timerId = null;

    const playerImg = new Image();
    playerImg.src = "hellokitty_transparent.png";

    const goalImg = new Image();
    goalImg.src = "strawberry_transparent.png";

    function generateMaze(rows, cols) {
      const m = Array.from({ length: rows }, () => Array(cols).fill(1));

      for (let r = 1; r < rows - 1; r += 2)
        for (let c = 1; c < cols - 1; c += 2)
          m[r][c] = 0;

      const dirs = [[-2,0],[2,0],[0,-2],[0,2]];
      const visited = Array.from({ length: rows }, () => Array(cols).fill(false));
      const stack = [[1,1]];
      visited[1][1] = true;

      while (stack.length) {
        const [r,c] = stack.at(-1);
        const neighbors = [];

        for (const [dr,dc] of dirs) {
          const nr=r+dr, nc=c+dc;
          if (nr>0 && nr<rows-1 && nc>0 && nc<cols-1 && !visited[nr][nc])
            neighbors.push([nr,nc]);
        }

        if (neighbors.length) {
          const [nr,nc] = neighbors[Math.floor(Math.random()*neighbors.length)];
          m[(r+nr)/2][(c+nc)/2] = 0;
          visited[nr][nc] = true;
          stack.push([nr,nc]);
        } else stack.pop();
      }

      return m;
    }

    function drawCircularImage(img, x, y, size) {
      ctx.save();
      ctx.beginPath();
      ctx.arc(x + size/2, y + size/2, size/2, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(img, x, y, size, size);
      ctx.restore();
    }

    function drawMaze() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      for (let r=0;r<ROWS;r++) {
        for (let c=0;c<COLS;c++) {
          ctx.fillStyle = maze[r][c] ? "#f27e8b" : "#fcd8dc";
          ctx.fillRect(c*CELL_SIZE, r*CELL_SIZE, CELL_SIZE, CELL_SIZE);
        }
      }

      const gSize = CELL_SIZE * SPRITE_SCALE;
      drawCircularImage(
        goalImg,
        goal.c*CELL_SIZE - (gSize - CELL_SIZE)/2,
        goal.r*CELL_SIZE - (gSize - CELL_SIZE)/2,
        gSize
      );

      const pSize = CELL_SIZE * SPRITE_SCALE;
      drawCircularImage(
        playerImg,
        player.c*CELL_SIZE - (pSize - CELL_SIZE)/2,
        player.r*CELL_SIZE - (pSize - CELL_SIZE)/2,
        pSize
      );
    }

    function startTimer() {
      timerSpan.textContent = timeLeft;
      timerId = setInterval(() => {
        if (gameOver) return;
        timeLeft--;
        timerSpan.textContent = timeLeft;

        if (timeLeft <= 0) {
          gameOver = true;
          messageDiv.textContent = "Time up! You lost :(";
          messageDiv.style.color = "red";
          clearInterval(timerId);
        }
      }, 1000);
    }

    function tryMove(dr, dc) {
      if (gameOver) return;
      const nr = player.r + dr;
      const nc = player.c + dc;
      if (maze[nr][nc]) return;

      player.r = nr;
      player.c = nc;
      drawMaze();

      if (player.r === goal.r && player.c === goal.c) {
        gameOver = true;
        messageDiv.textContent = "You Won :3";
        messageDiv.style.color = "gold";
        clearInterval(timerId);
      }
    }

    document.addEventListener("keydown", e => {
      if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))
        e.preventDefault();

      if (e.key==="ArrowUp") tryMove(-1,0);
      if (e.key==="ArrowDown") tryMove(1,0);
      if (e.key==="ArrowLeft") tryMove(0,-1);
      if (e.key==="ArrowRight") tryMove(0,1);
    });

    function init() {
      maze = generateMaze(ROWS, COLS);
      player = { r:1, c:1 };
      goal = { r:ROWS-2, c:COLS-2 };
      timeLeft = TOTAL_TIME;
      gameOver = false;
      messageDiv.textContent = "";
      clearInterval(timerId);
      drawMaze();
      startTimer();
    }

    restartBtn.addEventListener("click", init);
    init();
  </script>
</body>
</html>
